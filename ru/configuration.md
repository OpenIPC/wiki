# OpenIPC Wiki
[Оглавление](../README.md)

Настройка OpenIPC.
------------------

### Доступ в шелл.

Попасть в шелл свежепрошитой камеры очень просто. Для этого вам понадобится
ssh-клиент (для Windows подойдет [PuTTY](https://putty.org/)). Откройте терминал
и запустите `ssh`, указав IP-адрес вашей камеры (по умолчанию это 192.168.1.10,
но серевер DHCP может выдать камере и другой адрес) и имя пользователя __root__.
По умолчанию у этого пользователя нет пароля.
```
ssh root@192.168.1.10
```

### Настройка среды.

Сразу после установки новой прошивки необходимо очистить область оврелея. Для
этого выполните в шелле команду `firstboot`. Камера очистит оверлей и
перезагрузится.

Теперь необходимо настроить переменные среды загрузчика. Обычно это делают из
консоли загрузчика, но это также можно сделать и из Линукса при помощи команды
`fw_setenv`.

Установите MAC адрес из оригинальной прошивки, предпочтительный IP aдрес для
запроса к DHCP и прочие параметры сетевого подключения.
```
fw_setenv ethaddr D2:19:5E:EF:6A:61
fw_setenv ipaddr 192.168.1.99
fw_setenv netmask 255.255.255.0
fw_setenv gatewayip 192.168.1.1
```
Установите адрес TFTP сервера в вашей сети.
```
fw_setenv serverip 192.168.1.254
```

### Настройка сети.

Если вы планируете использовать беспроводное подключение, но вам понадобиться
настроить сеть. Откройте файл с настройками сетевых интерфейсов и сделайте
необходимые изменения.
```
vi /etc/network/interfaces
```
Пример настройки беспроводной карты MT7601 со статичным IP адресом.
```
auto wlan0
iface wlan0 inet static
    hwaddress ether $(fw_printenv -n ethaddr || echo 00:24:B8:FF:FF:FF)
    address 192.168.1.99
    netmask 255.255.255.0
    gateway 192.168.1.1
    pre-up modprobe mac80211
    pre-up modprobe mt7601sta
    pre-up echo -e "nameserver 192.168.1.53\nnameserver 208.67.222.222\n" >/tmp/resolv.conf
    pre-up echo -e "server 0.time.openipc.org iburst\nserver 1.time.openipc.org iburst\nserver 2.time.openipc.org iburst\nserver 3.time.openipc.org iburst" >/tmp/ntp.conf
    pre-up wpa_passphrase "MyWirelessNetwork" "SuperSecurePassword123" >/tmp/wpa_supplicant.conf
    pre-up sed -i '2i \\tscan_ssid=1' /tmp/wpa_supplicant.conf
    pre-up wpa_supplicant -B -D wext -i wlan0 -c/tmp/wpa_supplicant.conf
    post-down killall -q wpa_supplicant
```

### Доступ в веб интерфейс.

Для настройки прошивки откройте в браузере веб-интерфейс на 85 порту вашей
камеры. Логин и пароль по умолчанию -- __admin__ и __12345__, соответственно.
При первом входе система потребует установить ваш собственный пароль, прежде
чем допустить вас к рычагам управления.

### Часовая зона.

Начните настройку с установки правильного часового пояса. Найдите в меню раздел
_NTP Settings_, в поле _Zone name_ начните вводить имя крупного города в вашей
часовой зоне, затем выберите нужной значение из открывшегося списка доступных
городов. Убедитесь, что значение _Zone string_ при этом изменилось с GMT0,
которое установлено по умолчанию. Сохраните изменения настроек. Перезагрузите
камеру, чтобы применить изменения.

### Сетевые настройки.

Настройте сеть. По умолчанию камера использует настройки, полученные от сервера
DHCP. Если вам необходимо назначить камере статичный IP адрес, изменить имя
хоста или адрес сервера DNS, сделайте это на странице _Network Settings_.

### Настройки стримера Majestic.

#### RTSP

Для настройки протокола RTSP укажите номер порта, на котором будет отвечать
стример. По умолчанию это порт 554. URL для доступа к RTSP-потоку будет
выглядеть как _rtsp://camera-host:port/stream={0,1}_, где _camera-host_
-- это адреc вашей камеры в сети (полное доменное имя или IP адрес), _port_ --
это порт стимера RTSP, _{0,1}_ -- указание, какой из потоков вы хотите получить,
основной _(0)_ или дополнительный _(1)_.

Пример такой ссылки: _rtsp://192.168.1.123:554/stream=0_.

#### NETIP

Для настройки протокола NETIP укажите имя пользователя, пароль и номер порта, на
котором камера будет предоставлять доступ. Обратите внимание, что пароль надо
вводить в виде сгенерированного хэша. Хэш генерируется при помощи алгоритма 
Sofia Hash который можно получить выполнив в консоли команду
`echo $(netip_hash 12345)`. Таким образом, для пароля _12345_ хэш будет _6V0Y4HLF_ и 
соответственно в настройках регистратора указываем сам пароль, в настройках камеры - его хэш.

-- продолжение следует --
