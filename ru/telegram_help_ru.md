## Настройка ботов и каналов в телеграм для работы с OpenIPC

Для того, чтобы использовать телеграм в качестве бесплатной облачной платформы следует выполнить несколько несложных настроек. В начале мы настроим бота, затем канал, и, наконец, внесем соответствующие настройки в OpenIPC Вашей камеры

### Создание и настройка бота

Инструкция по созданию бота имеется в самой прошивке, на странице настройки сервиса Telegram

- В поиске вашего Telegram введите `BotFather`. Будьте внимательны, существует огромное количество ботов, сделанных максимально похожими на этот бот! У настоящего BotFather будет стоять отметка о верификации бота.
- Запустите бота, нажав `/start`
- Выполните `/newbot` и следуйте инструкциям бота. Введите название бота и имя бота. Последнее должно закачиваться на "bot" и начинаться с буквы.
- Если все сделано верно, то в ответ вам придет сообщение с токеном бота формата _XXXXXXXXXXX:AaAa-BbBbBbBb-CcCcCcCcCcCcCcCcCcCcCcCc_. Этот токен дает полный контроль над вашим ботом, следовательно не стоит передвать его третьим лицам или ботам, а также вводить в непроверенных местах!
- Введя команду `/mybots` можно по желанию настроить картинку бота, его описание и команды. В данный момент в этом нет необходимости.
- В сообщении с токеном также содержится ссылка на ваш новый бот. Перейдите по ней, убедитесь что бот запускается.

### Создание и настройка канала

Нет особой разницы, куда бот будет отправлять сообщение - в канал или в группу. Поэтому все, описанное ниже, будет справедливо и для групп также.

- Зайдите в ваше приложение Telegram и нажмите "Создать Канал" (или "Создать группу")
- Введите название канала
- Сделайте канал **публичным** (да, это важно, потом сделаете его частным, если захотите)
- На этапе добавления пользователей начните вводить имя вашего бота в поиске. Добавьте бота и выдайте ему права администратора.
- Теперь вам необходимо выяснить Chat ID вашего канала (или группы). Эта функция скрыта по соображениям безопасности. Существует по крайней мере три способа получить Chat ID:
  - Написать специальным ботам в телеграм (мы не будем так делать, не зная авторов этих ботов)
  - Использовать  запрос https к боту и изучив JSON ответ (можно, но достаточно сложно)
  - Использовать Telegram WEB (Этот способ мы и будем использовать)
    - Зайдите на [web.telegram.org](web.telegram.org)
    - Подключите свой аккаунт телеграм
    - Зайдите в ваш канал или группу и обратите внимание на адресную строку. В ней будет числовой идентификатор после символа `#`. Для групп и каналов он будет начинаться со знака `-`
    - Добавьте `-100` перед идентификатором канала или группы, если его нет,  например `-1001234567890`, где `1234567890` - это числовой идентификатор чата, полученный из веб-версии Telegram

### Настройка OpenIPC

В меню прошивки, в разделе **Services** выберите **Send to Telegram **

- В появившемся плагине активируйте настройку **Enable sending to Telegram**
- Ниже введите **Tокен** вашего бота, полученный ранее.
- Далее введите **Chat ID** вашей группы или канала. Не забудьте добавить `-100` если ID не содержит его
- Настройте остальные параметры отправки сообщения

### Проверка работоспособности

- Убедитесь в том, что в секции Preview отображается картинка с камеры.
- Получите доступ к консоли камеры, например используя SSH
- Выполните команду `send2telegram.sh -v`
- Если все введено верно, то в канал или группы придет сообщение, содержащее изображение с камеры
- Вывод команды в консоли может пригодиться для изучения и отладки

