# OpenIPC Wiki
[Оглавление](index.md)

Вопросы и ответы
----------------

### Как настроить авторизацию ssh-сессии по ключу

#### На камере
Откройте ssh сессию и создайте непустой пароль пользователю root.
По умолчанию в нашей прошивке у пользователя root пароля нет.
Имейте в виду, что после того как вы создали пароль, все последующие
новые ssh сессии до момента настройки авторизации по публичному ключу,
а так же при попытке захода с компьютера, где такого ключа нет, будут
требовать авторизации именно с этим паролем. Не забудьте его!
```
passwd
```

#### На десктопе
Скопируйте публичный ключ на камеру, авторизовавшись созданным выше паролем.
```
ssh-copy-id root@192.168.1.666
```

#### На камере
Создайте папку `.ssh` в домашней директории пользователя root
и скопируйте в неё файл с хранилищем авторизованных ключей.
```
mkdir ~/.ssh
cp /etc/dropbear/authorized_keys ~/.ssh/
```

#### На десктопе
Откройте новую сессию, чтобы проверить, что авторизация проходит по открытому ключу, без участия пароля.
```
ssh root@192.168.1.666
```

### Majestic

##### Как получить дамп памяти для отладки?
Зайдите на камеру через ssh и выполните следующую команду:
```
killall -9 majestic && ulimit -c unlimited && echo /tmp/%e.%p.%s.%t.core > /proc/sys/kernel/core_pattern && majestic
```
Файл с дампом будет находится в каталоге /tmp/, окуда вы можете скопировать его на другой компьютер командой `scp`, например:
```
scp /tmp/*.core username@192.168.1.2:
```
Можно даже автоматизировать сохранение полученного дампа при перезапуске камеры.
Для этого создайте скрипт `/etc/init.d/S97coredump` следующего содержания 
(не забудьте отредактировать содержимое переменной STORAGE):
```
#!/bin/sh

COREDUMP=/tmp/*.core
STORAGE=username@192.168.1.2:/path/to/save/dumps/  # adjust to match your setup!

ls $COREDUMP 2>/dev/null
if [ $? -eq 0 ]; then
  scp $COREDUMP $STORAGE && rm $COREDUMP
fi
```

##### Можно-ли вывести данные для настройки автоматической фокусировки линз вместо текущего sample_af в стандартный /metrics?
Нет, это отдельный тяжелый алгоритм, его нет смысла запускать просто так.
